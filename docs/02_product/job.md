# Opinio ATS｜Job / Batch 定義一覧

本ドキュメントは、Opinio ATS における  
**非同期処理（Job）およびバッチ処理（Batch）** を一覧化した正本である。

Job / Batch は以下を責務とする。

- 即時性を要求しない処理を安全に実行する
- 重い集計・解析処理を UI から切り離す
- 再実行可能・説明可能な形で結果を生成する
- 判断・評価・結論には一切関与しない

---

## Job / Batch 設計原則（厳守）

- Job は **事実処理のみ** を行う
- Job は **合否・良否・優劣を決定しない**
- Job の結果は **再計算可能** であること
- UI 表示は Job の結果を「参照」するのみ
- 途中失敗・再実行を前提とする

---

## 3-1 ダッシュボード関連

### DashboardSnapshotJob
**目的**  
ダッシュボード KPI の定期スナップショット生成。

**責務**
- 指標定義に基づく数値集計
- 期間単位での値保存
- 過去比較用データ生成

**実行タイミング**
- 日次 / 週次（設定可能）
- 手動再実行可

**出力**
- DashboardMetricSnapshot

---

## 3-2 パイプライン分析

### PipelineAnalyticsJob
**目的**  
選考ステップの進行・滞留状況を集計する。

**責務**
- ステップ滞留日数計算
- ステップ遷移履歴の集計
- 集計用中間データ生成

**注意**
- 「良い／悪い」の評価は行わない
- 数値は事実のみ

---

## 3-3 レポート生成

### ReportSnapshotJob
**目的**  
分析・レポート用の集計結果をスナップショット化する。

**責務**
- レポート定義に基づく集計
- JSON 形式での結果保存
- 過去条件の再現性確保

**対象レポート**
- 採用リードタイム
- チャネル別分析
- 面接プロセス分析

**出力**
- ReportResultSnapshot

---

## 3-4 応募取り込み

### IntakeReceiveJob
**目的**  
外部からの応募通知を安全に受信・保存する。

**責務**
- メール / Webhook / API 受信
- raw_payload 保存
- 非同期での Intake 作成

**注意**
- 評価・分類は行わない
- 欠損前提で保存

---

### IntakeParseJob
**目的**  
応募 raw データの構造整理を補助する。

**責務**
- raw_payload の解析
- Draft 用データ生成
- 欠損項目の安全処理

**注意**
- 正式応募化は行わない

---

## 3-5 エージェント推薦

### RecommendationReceiveJob
**目的**  
エージェントからの推薦情報を受信・保存する。

**責務**
- メール / Webhook 受信
- raw_payload 保存
- 推薦データ生成

---

### RecommendationParseJob
**目的**  
推薦文の構造整理を補助する。

**責務**
- 推薦理由・マッチ・懸念点抽出補助
- 不完全データ前提処理

**注意**
- 推薦内容の正否判断は行わない

---

## 3-6 通知・連携

### NotificationDispatchJob
**目的**  
システム内通知・外部通知の送信。

**責務**
- 通知内容生成
- 配信チャネル制御
- 再送・失敗管理

**注意**
- 判断・催促ロジックは持たない

---

## 3-7 メンテナンス・補助

### AuditLogCleanupJob
**目的**  
監査ログの整理・保管。

**責務**
- 保存期間に基づく整理
- アーカイブ処理

---

### OrphanDataCheckJob
**目的**  
紐付け漏れ・孤立データの検出。

**責務**
- 未紐付け Draft / Recommendation 検出
- 管理者向け通知（任意）

---

## Job / Batch が扱う主データ

- DashboardMetricSnapshot
- ReportResultSnapshot
- ApplicationIntake
- IntakeCandidateDraft
- AgentRecommendation
- AuditLog

---

## Job 層で「やらないこと」

- 合否・評価・ランキング決定
- 自動スコアリング
- 処遇・制度判断
- 人事評価への接続
- 判断理由の生成

---

## 再実行・失敗時の考え方

- Job は **冪等性** を持つ
- 中途失敗は再実行可能
- 結果不整合は Service 層で吸収
- 手動再実行 UI を将来拡張可能

---

## 一文定義（迷ったとき用）

Job / Batch は、  
**人が考えるための材料を、静かに裏側で整える仕組みである。**
