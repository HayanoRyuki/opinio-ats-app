# 応募取り込み（Application Intake）

本ドキュメントは、Opinio ATS における
**機能定義 2-9：応募取り込み（Application Intake）** を扱う。

---

## 機能の位置づけ
応募取り込みは、
Opinio ATS において **外部で発生した応募・推薦・反応をATSに集約するための入口機能**である。

本機能は、
- 応募を「正しく評価する」ためのものではなく
- 応募を「取りこぼさず、後続プロセスにつなぐ」ためのもの

として設計される。

応募取り込みは、
**選考の開始点ではあるが、判断の開始点ではない。**

---

## 基本原則（3つの設計思想）

| 原則 | なぜそうするのか |
|---|---|
| ① 取り込み時点では評価しない | 「良い・悪い」の判断は後で行う。まずは漏れなく集めることが目的 |
| ② 情報が不完全でもOK | 名前だけ、メールだけ、という状態でも取り込める。完璧を求めると取りこぼしが発生する |
| ③ 人が確認してから選考対象に | 自動で選考に進めることはしない。必ず人事担当者が確認してから正式な候補者として登録する |

> **ポイント**：「取り込み」は評価の入口ではなく、整理の入口として設計している。

---

## 4つの応募経路

| 経路 | どこから来るか | 応募の性質 |
|---|---|---|
| 直接応募 | 自社の採用サイト、採用LP | 正式な応募 |
| スカウト | ビズリーチ、Wantedly、Green等 | 興味ありの段階（仮応募） |
| エージェント | 人材紹介会社からの推薦 | 正式な応募（書類選考から） |
| リファラル | 社員からの紹介 | 正式な応募 |

---

## 3-1. 直接応募（自社採用サイト）

### どんな応募か
自社の採用サイトや採用LPのフォームから来る応募。
応募者が自分で情報を入力して送信する。

### md要件（設計方針）
- 通知受信 ＝ **正式な応募**として扱う
- 応募と求人が確定している状態

### 実装状況

| 項目 | 状態 | 備考 |
|---|---|---|
| ATS側のデータ受け取り機能 | ✅ | 実装済み |
| 取り込み一覧・詳細画面 | ✅ | 動作確認済み |
| 候補者として登録する機能 | ✅ | |
| 採用サイト側の改修 | ❌ | 未着手 |

### 検討事項
- 採用サイト制作会社への改修依頼（フォームからATSへデータ送信）
- 履歴書ファイルの保存先（S3など）の決定
- 応募完了後の自動返信メールの設定

---

## 3-2. スカウトサービス（ビズリーチ・Wantedly等）

### どんな応募か
こちらからスカウトを送り、候補者が「興味あり」「話を聞きたい」と反応したもの。

### md要件（設計方針）
- この時点では応募は未完了（興味ありの段階）
- ATS上では **「候補」として扱う（仮応募）**
- 面談確定などで正式応募に昇格する

### 実装状況

| 項目 | 状態 | 備考 |
|---|---|---|
| ATS側のデータ受け取り機能 | ✅ | 実装済み |
| 取り込み一覧・詳細画面 | ✅ | 動作確認済み |
| 「仮応募」と「正式応募」の区別 | ❌ | 未実装（要検討） |
| ビズリーチとの自動連携 | ❌ | 未設定 |
| Wantedlyとの自動連携 | ❌ | 未設定 |
| Greenとの連携 | — | 手動入力で対応可 |

### ⚠️ md要件との差異
設計書では「スカウト反応は仮応募として区別する」となっているが、
**現状の実装では他のチャネルと同じ扱いになっている。**

### 検討事項
- 「仮応募」→「正式応募」の昇格フローを実装するか？
- ビズリーチのWebhook連携設定
- WantedlyのAPI連携設定
- 自動連携できない場合のZapier/Make経由の検討

---

## 3-3. エージェント（人材紹介会社）

### どんな応募か
人材紹介会社（リクルートエージェント等）から推薦されてくる候補者。
応募の起点は候補者ではなくエージェント。

### md要件（設計方針）
- 通知受信 ＝ **正式な応募**として扱う（応募承諾をとっているため）
- 履歴書・職務経歴書は必須
- 書類選考から開始する

### 実装状況

| 項目 | 状態 | 備考 |
|---|---|---|
| ATS側のデータ受け取り機能 | ✅ | 実装済み |
| エージェント会社名・担当者の記録 | ✅ | |
| 推薦コメントの記録 | ✅ | |
| 取り込み一覧・詳細画面 | ✅ | 動作確認済み |
| 履歴書の必須チェック | ❌ | 現状は任意 |

### ⚠️ md要件との差異
設計書では「履歴書・職務経歴書は必須」となっているが、
**現状は任意項目になっている。**

### 検討事項
- 履歴書を必須にするか？（書類なしで推薦が来ることもある？）
- 取引エージェント会社のマスタ管理
- 選考状況のエージェントへの共有方法（将来）

---

## 3-4. リファラル（社員紹介）

### どんな応募か
社員が知人・友人・元同僚などを紹介するもの。
紹介者（社員）の情報と一緒に登録される。

### md要件（設計方針）
- 通知受信 ＝ **正式な応募**として扱う
- 紹介者（誰が紹介したか）の記録が必要

### 実装状況

| 項目 | 状態 | 備考 |
|---|---|---|
| ATS側のデータ受け取り機能 | ✅ | 実装済み |
| 紹介者の社員番号・氏名・部署の記録 | ✅ | |
| 候補者との関係性の記録 | ✅ | 友人/元同僚等 |
| 取り込み一覧・詳細画面 | ✅ | 動作確認済み |
| 社内向けリファラルフォーム | ❌ | 未作成 |

### 検討事項
- 社員が簡単に紹介できるフォームを社内ポータルに設置するか？
- 紹介報酬制度の運用ルール（入社時？試用期間後？）
- 紹介者への選考状況フィードバック方法
- 同じ人を複数の社員が紹介した場合のルール

---

## チャネル別 状態サマリ

| チャネル | ATS機能 | 外部連携 | 要検討事項 |
|---|---|---|---|
| 直接応募 | ✅ 完了 | ❌ 未接続 | 採用サイト改修依頼 |
| スカウト | ✅ 完了 | ❌ 未接続 | 「仮応募」の扱い |
| エージェント | ✅ 完了 | — | 履歴書必須化 |
| リファラル | ✅ 完了 | — | 社内フォーム設置 |

---

## 応募から選考開始までの流れ

| 順番 | ステップ | 説明 |
|---|---|---|
| ① | 応募が届く | 各サービスから通知メールやデータが届く |
| ② | ATSに取り込み | データを保存（元データも残す） |
| ③ | 「確認待ち」として保管 | まだ選考には進んでいない状態 |
| ④ | 人事担当者が確認 | 重複チェック・内容確認（ここが重要） |
| ⑤ | 正式な候補者として登録 | 選考開始（パイプラインに配置） |

> **重要**：④のステップを必ず経由することで、「誰が、いつ、この人を選考対象にしたか」が明確になる。

---

## 今後検討が必要なこと

### 🔴 優先度：高

1. **スカウト反応の扱い方**
   → 「興味あり」の段階と「正式な応募」を区別すべきか？

2. **各スカウトサービスとの自動連携設定**
   → ビズリーチ・Wantedlyを優先的に検討

3. **自社採用サイトの改修依頼**
   → フォームからATSにデータを送る仕組みが必要

### 🟡 優先度：中

4. **エージェント経由の履歴書を必須にするか**
   → 現状は任意だが、書類選考を前提とするなら必須が望ましい

5. **リファラル用の社内フォーム設置**
   → 社員が簡単に紹介できる仕組み

### ⚪ 優先度：低（将来対応）

- CSVでの一括取り込み機能
- エージェントへの選考状況の自動共有
- リファラル報酬の管理機能

---

## 要確認事項（ご相談事項）

| # | 相談事項 | 確認したいこと |
|---|---|---|
| 1 | スカウト反応を「仮応募」として扱うか | 運用イメージの確認 |
| 2 | 優先的に接続するサービスの決定 | 利用頻度・重要度の確認 |
| 3 | 採用サイト改修の外部依頼 | 予算・スケジュールの確認 |

---

## データモデル（必須）

### ApplicationIntake
外部から入ってきた **加工前の応募データ** を保持する。

- intake_id
- company_id
- channel_type（direct / scout / agent / referral）
- source_type（mail / form / api）
- raw_payload（JSON / mail 原文）
- received_at
- processed_at（null 可）
- status（new / processed / ignored）

※ raw_payload は **削除しない**
※ 監査・再解釈のため保持する

---

### IntakeCandidateDraft
取り込み後に生成される **整理前の候補者下書き**。

- draft_id
- intake_id
- person_id（未確定可）
- name（未確定可）
- email（未確定可）
- resume_text（要約可）
- memo
- created_at

※ 正式候補者になる前段階の存在
※ 破棄・統合されうることを前提とする

---

## Controller / Service / Job 概要

### ApplicationIntakeController
- index：取り込み一覧
- show：原文・下書き確認
- classify：チャネル変更
- convert：正式応募へ昇格

### IntakeParserService
- 通知メール／フォーム構造解析
- 必須項目抽出
- 欠損前提の安全設計

### IntakeConversionService
- Draft → Candidate / Application 変換
- 重複候補者チェック
- person_id 紐付け

### IntakeReceiveJob
- メール受信
- Webhook 処理
- 非同期保存

---

## 他機能との関係
- 候補者管理：正式昇格後に統合
- パイプライン管理：昇格後に初期ステップへ配置
- エージェント推薦：推薦通知の入口
- 分析・レポート：チャネル分析の基礎データ

---

## 一文定義（迷ったとき用）
応募取り込みは、
**評価の入口ではなく、整理の入口である。**
