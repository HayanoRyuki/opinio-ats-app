# 応募取り込み（メール等）

本ドキュメントは、Opinio ATS における  
**機能定義 2-9：応募取り込み（Application Intake）** を扱う。

---

## 機能の位置づけ
応募取り込みは、  
Opinio ATS において **外部で発生した応募・推薦・反応をATSに集約するための入口機能**である。

本機能は、
- 応募を「正しく評価する」ためのものではなく
- 応募を「取りこぼさず、後続プロセスにつなぐ」ためのもの

として設計される。

応募取り込みは、  
**選考の開始点ではあるが、判断の開始点ではない。**

---

## 中核コンセプト：通知メール起点
Opinio ATS では、  
**応募取り込みの共通起点を「応募通知メール」とする**。

API 連携や専用フォームの有無に関わらず、

- 応募
- スカウトへの反応
- エージェント推薦

は、最終的に **通知メールとして人に届く**。

本機能は、この通知メールを起点に、
ATS への一元取り込みと整理を可能にする。

---

## 想定経路
以下の経路からの応募・推薦を想定する。

- メール応募（応募通知メール）
- 外部フォーム（採用ページ・媒体フォーム）
- エージェント経由（推薦メール・通知）
- 自社サイト応募（コーポレート／採用LP）
- API / Webhook（将来拡張）

※ 連携方式の違いに関わらず、  
**「通知が届く」ことを共通起点**とする。

---

## 基本思想（最重要）
- 取り込み時点では一切評価しない
- 情報欠損・不完全を前提とする
- raw データ（原文・原JSON）は必ず保持する
- 正規化・確定は人の確認を前提とする

応募取り込みは、  
**「仮置き」と「整理前提」のデータ層**である。

---

## チャネル分類（必須）
通知メールを起点とした応募は、以下のチャネルに分類される。

| 区分 | チャネル | 意味 |
|---|---|---|
| D | ダイレクトリクルーティング | スカウトに対する前向き反応 |
| M | 掲載媒体・自社フォーム | 応募フォーム完了 |
| A | エージェント | エージェントによる推薦 |
| S | 自社サイト応募 | 採用LP・コーポレート応募 |

※ 分類は自動・手動いずれでもよい  
※ 誤分類前提で、後から修正可能とする

---

## チャネル別のATS上の扱い

### ダイレクトリクルーティング（D）
- 通知の意味：スカウトへの前向き反応
- この時点では応募は未完了
- ATS上では **仮応募（候補）** として扱う
- 面談確定などで正式応募に昇格する

---

### 掲載媒体・自社フォーム（M）
- 通知の意味：応募フォーム完了
- 応募は確定状態
- 書類提出済み前提が多い
- 通知受信＝**正式応募**

---

### エージェント（A）
- 通知の意味：エージェント推薦
- 応募起点は候補者ではなくエージェント
- 履歴書・職務経歴書は必須
- 通知受信＝**正式応募**
- 書類選考から開始する

---

### 自社サイト応募（S）
- 通知の意味：自社応募完了
- 応募・求人が確定している
- 通知受信＝**正式応募**

---

## データモデル（必須）

### ApplicationIntake
外部から入ってきた **加工前の応募データ** を保持する。

- intake_id
- company_id
- channel_type（D / M / A / S）
- source_type（mail / form / api）
- raw_payload（JSON / mail 原文）
- received_at
- processed_at（null 可）
- status（new / processed / ignored）

※ raw_payload は **削除しない**  
※ 監査・再解釈のため保持する

---

### IntakeCandidateDraft
取り込み後に生成される **整理前の候補者下書き**。

- draft_id
- intake_id
- person_id（未確定可）
- name（未確定可）
- email（未確定可）
- resume_text（要約可）
- memo
- created_at

※ 正式候補者になる前段階の存在  
※ 破棄・統合されうることを前提とする

---

## 取り込みフロー（共通）

1. 応募通知メール／入力を受信
2. raw_payload として保存
3. チャネル判定（自動 or 手動）
4. Draft（整理前下書き）を生成
5. 人が確認・補正・統合
6. 正式な Candidate / Application に昇格

---

## この機能でやること
- 応募・推薦通知の受信と保存
- raw データの保持
- チャネル分類の管理
- Draft の生成・編集
- Candidate / Application への昇格
- 分類変更・昇格履歴の保持

---

## この機能でやらないこと
- 応募時点での自動評価
- 自動不採用
- スコアリング
- 採否・処遇判断への接続

---

## Controller / Service / Job 概要

### ApplicationIntakeController
- index：取り込み一覧
- show：原文・下書き確認
- classify：チャネル変更
- convert：正式応募へ昇格

### IntakeParserService
- 通知メール／フォーム構造解析
- 必須項目抽出
- 欠損前提の安全設計

### IntakeConversionService
- Draft → Candidate / Application 変換
- 重複候補者チェック
- person_id 紐付け

### IntakeReceiveJob
- メール受信
- Webhook 処理
- 非同期保存

---

## 他機能との関係
- 候補者管理：正式昇格後に統合
- パイプライン管理：昇格後に初期ステップへ配置
- エージェント推薦：推薦通知の入口
- 分析・レポート：チャネル分析の基礎データ

---

## 一文定義（迷ったとき用）
応募取り込みは、  
**評価の入口ではなく、整理の入口である。**
