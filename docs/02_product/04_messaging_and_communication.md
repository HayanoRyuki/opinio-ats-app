# メッセージ・コミュニケーション

本ドキュメントは、Opinio ATS における **機能定義 2-4：メッセージ・コミュニケーション** を扱う。

## 機能の位置づけ
メッセージ・コミュニケーション機能は、候補者および社内関係者とのやりとりを一元管理し、  
**選考文脈と切り離されない形で記録・参照するための補助機能**である。

Opinio ATS では、メッセージを単なる「連絡手段」ではなく、  
**採用判断に至る過程を振り返るための文脈情報**として扱う。

---

## 扱う対象
- 候補者とのメール送受信
- 選考に関する社内メモ
- 候補者に共有しない内部コメント

---

## 設計上の前提
以下は、本機能を判断確定ではなく「文脈記録」として扱うための前提である。

- 正式な合否通知文の自動生成は行わない
- メッセージはあくまで記録・参照用途に限定する
- 判断や確定の証拠とならない表現を前提とする
- 評価・査定・承認を示す語彙は使用しない

---

## 設計思想
- メッセージは **応募（Application）に紐づけて管理**する
- 候補者単体ではなく、「どの選考文脈でのやりとりか」を重視する
- 時系列で追えることを最優先とする

---

## データモデル（必須）

### Message
- message_id
- application_id
- channel_type（email / internal）
- sender_type（candidate / user / system）
- body
- sent_at
- created_at

### MessageTemplate
- template_id
- company_id
- usage_type（案内 / 日程 / リマインド 等）
- body
- created_at

※ テンプレートは「下書き用途」に限定する。  
※ 自動確定・自動送信には使用しない。

---

## コントローラ設計

### MessageController
- index  
  応募単位のメッセージ一覧表示
- store  
  メッセージ作成・送信
- show  
  メッセージ詳細表示

### MessageTemplateController
- index  
  テンプレート一覧
- store  
  テンプレート作成・編集

---

## ビュー設計
- messages/thread  
  応募単位のメッセージスレッド
- messages/form  
  メッセージ作成画面
- templates/index  
  メッセージテンプレート管理画面

---

## Controller / View 以外に必要な要素

### Service
#### MessageSendService
- メッセージ送信処理の集約
- チャネルごとの差分吸収
- 送信ログの保存  

Controller に直接送信処理を書かない。

---

### Job（非同期処理）
- SendMessageJob  

外部メール送信は必ず非同期で行う。  
失敗時はリトライ可能とし、  
選考進行をブロックしない。

---

### Policy
- MessagePolicy  

応募・求人・担当者の関係に基づく閲覧・送信制御。

---

## 他機能との関係
- 選考パイプライン：  
  ステップ進行と文脈を共有
- 日程調整：  
  日程確定・変更通知を送信
- ダッシュボード：  
  返信待ち・未対応メッセージを可視化

---

## 本機能で「やらないこと」
以下は、Opinio ATS の思想に基づく設計判断である。

- 合否通知文の自動生成
- 評価・判断の確定を示すメッセージ管理
- メッセージ内容を正式記録として扱うこと

メッセージ・コミュニケーション機能は、  
**判断を支える文脈を残すための補助機能**であり、  
判断そのものを代替する仕組みではない。
