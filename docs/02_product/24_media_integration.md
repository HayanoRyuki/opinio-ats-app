# 媒体連携（Media Integration）

本ドキュメントは、Opinio ATS における  
**機能定義：媒体連携** を扱う。

---

## 機能の位置づけ
媒体連携は、  
Opinio ATS において **外部採用媒体から発生する応募情報を、自動的に受信・整理し、正式な応募へ接続するための機能**である。

本機能は、
- 媒体の成果を評価する
- 媒体ごとに採否を自動判断する

ためのものではない。

あくまで、
**複数媒体に分散する応募入口を一本化し、取りこぼしなく採用プロセスへ接続する**
ことを目的とする。

---

## 基本思想（重要）
- 媒体ごとの差異は「入口の違い」として扱う
- 取り込み時点では評価・選別を行わない
- 生データ（raw）は必ず保持する
- 正規化・確定は人の確認を前提とする

媒体連携は、  
**応募チャネルドメインの自動化拡張**である。

---

## 対応する媒体種別
- 求人検索エンジン
- 採用媒体（新卒・中途）
- ダイレクトリクルーティング媒体
- 媒体提供の応募フォーム
- 将来的な API / Webhook 連携

※ 特定媒体名への依存は持たない  
※ 媒体追加は設定ベースで拡張可能とする

---

## 主な機能

### 媒体接続設定
- 媒体ごとの連携 ON / OFF
- 連携方式の選択  
  （メール / API / Webhook / CSV）
- 認証情報の管理（APIキー等）

---

### 応募データ自動取り込み
- 媒体からの通知・データ受信
- raw_payload として保存
- 受信時刻・媒体識別情報の保持
- 失敗時のリトライ・エラーログ

---

### 下書き（Draft）生成
- 媒体データを元に Draft を自動生成
- 欠損項目の明示
- 重複候補者チェック（参照のみ）

---

### 人による確認・確定
- 媒体差分を吸収した入力補助
- Candidate / Application への昇格
- 昇格後は媒体データを正としない

---

## データモデル（必須）

### MediaSource
- media_source_id
- company_id
- name
- integration_type  
  （email / api / webhook / csv）
- config  
  （認証情報・接続設定）
- is_active
- created_at
- updated_at

---

### MediaApplicationIntake
- intake_id
- media_source_id
- company_id
- raw_payload
- received_at
- processed_at
- status

---

## フロー（概要）
1. 媒体から応募データを受信
2. MediaApplicationIntake として raw 保存
3. 応募チャネル分類（media）
4. Draft 生成
5. 人が確認・補正
6. Candidate / Application へ昇格

---

## 設計上のルール
- 媒体連携データは削除しない
- 同一候補者の重複検知は補助情報として提示
- 媒体固有項目は raw にのみ保持
- 昇格後の正は ATS 側データとする

---

## コントローラ設計

### MediaIntegrationController
- index  
  媒体連携一覧
- create  
  媒体追加
- update  
  設定変更
- deactivate  
  連携停止

---

### MediaIntakeController
- receive  
  応募受信エンドポイント
- retry  
  再処理

---

## Service

### MediaIntegrationService
- 接続設定管理
- 認証情報検証
- 受信方式の抽象化

---

### MediaIntakeService
- raw 保存
- Draft 生成
- エラー処理

---

## 権限・制御
- 媒体設定は管理権限のみ操作可能
- 応募データ閲覧は通常応募と同一権限
- 認証情報は暗号化して保持

---

## 監査・ログ
- 媒体設定変更は監査ログ対象
- 受信失敗・再処理履歴を保持
- raw_payload は削除不可

---

## 他機能との関係
- 応募チャネル：  
  media として取り込み
- 候補者管理：  
  確定後に Candidate 生成
- 重複検知：  
  候補者重複アラートと連携
- ダッシュボード：  
  媒体別集計対象

---

## 本機能で「やらないこと」
- 媒体成果の自動評価
- 採否の自動判断
- 媒体ごとの UI 分岐
- 媒体仕様への過度な最適化

---

## 一文定義（迷ったとき用）
媒体連携は、  
**分散した応募入口をまとめ、正規の採用プロセスへ接続するための機能である。**
