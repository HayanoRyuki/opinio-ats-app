# 通知（Notification）

本ドキュメントは、Opinio ATS における  
**機能定義 2-12：通知（Notification）** を扱う。

通知機能は、特定の画面や機能に閉じず、  
**プロダクト全体に横断的に作用する基盤機能**として設計する。

---

## 機能の位置づけ
通知は、  
Opinio ATS において **「今、対応が必要な事実」に気づくための補助機能**である。

本機能は、
- 判断や評価を代替しない
- 行動を強制しない
- 状態変化や未対応事項を「知らせる」ことに徹する

ことを目的とする。

通知は **意思決定の起点ではなく、注意喚起のレイヤー**である。

---

## 通知の基本思想（重要）
- 通知 = アラートではない  
- 通知 = 判断ではない  
- 通知 = タスク管理ではない  

通知は、
**「事実が発生した」「状態が変わった」「未対応がある」**
という *出来事* を伝えるためのものである。

---

## 通知対象となる主な事象

### 候補者・選考に関する通知
- 面接日程が確定した
- 面接結果（評価メモ）が未入力
- 日程調整の返信待ち
- 一定期間ステップが変わっていない応募（長期滞留）

---

### コミュニケーションに関する通知
- 新しいメッセージの受信
- エージェントからの推薦到着
- 候補者からの返信

---

### 管理・設定に関する通知
- ユーザー招待の承認／期限切れ
- 権限・ロール変更
- 連携エラー（カレンダー・外部連携）

---

## 通知の種類

### 即時通知
- 状態変化と同時に発生
- 画面上の通知バッジ／一覧に反映

例：
- 新規応募の到着
- 推薦の受信

---

### 状態ベース通知
- 一定条件を満たした場合に発生
- バッチ／定期チェックで生成

例：
- 評価未入力が一定時間経過
- 長期滞留応募

---

## 通知の表示仕様（UI前提）
- グローバルメニューの「通知」から一覧表示
- 未読件数をバッジで表示
- 通知クリックで **該当画面へ遷移**（一覧・詳細・設定）

※ UI詳細は `05_ui/00_global_menu.md` にて定義する

---

## 通知の制御方針
- 通知は **ON / OFF 設定可能**
- 通知単位で有効／無効を切り替えられる
- ロール・権限に応じて通知対象を制御する

---

## データモデル（必須）

### Notification
- notification_id
- company_id
- user_id
- notification_type
- title
- body
- related_entity_type
- related_entity_id
- is_read
- created_at

---

### NotificationSetting
- setting_id
- user_id
- notification_type
- is_enabled
- created_at
- updated_at

---

※ 通知内容は「事実の要約」に留める  
※ 評価・判断・理由は含めない

---

## 通知生成の考え方
- 各ドメインは **通知を直接表示しない**
- 状態変化をイベントとして発火
- 通知生成は NotificationService が一元管理する

---

## コントローラ設計

### NotificationController
- index  
  通知一覧取得
- markAsRead  
  既読化
- markAllAsRead  
  一括既読
- settings  
  通知設定取得・更新

---

## Service

### NotificationService
- 通知生成ロジックの集中管理
- 通知タイプ別テンプレ管理
- 重複通知防止

---

## Job / Batch

### NotificationConditionCheckJob
- 状態ベース通知の定期チェック
- 長期滞留・未入力チェック
- 非同期生成

---

## Policy
- NotificationPolicy  
  通知閲覧権限
- NotificationSettingPolicy  
  設定変更権限

---

## 他機能との関係
- 候補者管理／選考パイプライン  
  → 状態変化イベントの発生源
- メッセージ／エージェント推薦  
  → 通知生成トリガー
- 設定・チーム管理  
  → 通知対象・制御条件

---

## 本機能で「やらないこと」
- タスク完了管理
- 自動リマインドによる強制行動
- 採否・評価の示唆
- 処遇判断への接続

---

## 一文定義（迷ったとき用）
通知は、  
**判断を下すための機能ではなく、気づくための機能である。**
