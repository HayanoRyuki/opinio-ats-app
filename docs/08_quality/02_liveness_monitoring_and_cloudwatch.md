# 死活監視と CloudWatch 設計

## 死活監視の定義
本ドキュメントにおける死活監視とは、
Opinio の各プロダクトが「正常に動作しているか」「致命的な異常が起きていないか」を
継続的に把握するための最小限の仕組みを指す。

重要なのは、
- すべてを監視することではない
- 判断に必要な情報だけを確実に取ること

CloudWatch は「自動で全部を見てくれる仕組み」ではなく、
**人が“見るべきもの”を決めて初めて意味を持つ監視基盤**である。

## 結論：最小限の死活監視から始める
Opinio における CloudWatch 利用方針は以下とする。
- 初期は死活監視と致命的エラーのみ
- 見ない指標は取らない
- 判断に使わないログは増やさない
- プロダクトごとに重要度を分ける

CloudWatch は目的ではなく、運用を楽にするための道具である。

## なぜ最小構成から始めるのか
### 理由①：見ないログは運用負荷になる
- アラート過多で見なくなる
- 本当に重要な異常が埋もれる
- 判断精度が下がる

特に少人数体制では、監視項目は少ないほど良い。

### 理由②：プロダクトごとに重要度が異なる
- 業務システム（ATS）
- 候補者向け（Career）
- 公開サイト（採用ページ）

「止まったら即対応すべきもの」と
「朝見れば良いもの」を明確に分ける。

## 初期に監視する項目（リリース初期）
### インフラ死活
- ALB / EC2 / ECS ヘルスチェック失敗
- RDS 接続不可
- 5xx エラー急増

### アプリケーションレベル
- ERROR / FATAL ログ
- 認証失敗の異常増加
- 外部API連携の完全失敗

### 監視しないもの（初期）
- レスポンスタイムの微細な変動
- INFO / DEBUG ログ
- 利用状況分析用メトリクス

## CloudWatch の役割整理
### Metrics
- 数値で異常を検知
- CPU 使用率
- エラー数
- 接続数

### Logs
- 何が起きたかを確認
- アプリが意図的に吐くログのみ
- 共通フォーマットを前提

### Alarms
- 人を起こすための仕組み
- 本当に必要なものだけ
- 迷ったら作らない

## 横断的な確認観点
- 今、使えないプロダクトはあるか
- 新しい致命的エラーは出ていないか
- 昨日まで動いていたものが止まっていないか

詳細分析は、問題発生時のみ行う。

## 監視運用のタイムテーブル
- 初期：死活監視＋ERRORログのみ
- 成長後：プロダクト別アラート整理
- 将来：SLA対象のみ監視強化

## まとめ
- CloudWatch は「全部見る」道具ではない
- 判断に必要な最小限だけを見る
- プロダクト特性ごとに監視粒度を分ける
